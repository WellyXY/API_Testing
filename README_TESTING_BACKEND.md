# æ–°æµ‹è¯•åç«¯ (Testing Backend) ä½¿ç”¨è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

æ–°çš„æµ‹è¯•åç«¯é‡‡ç”¨äº†æ–°çš„æ¶æ„è®¾è®¡ï¼Œè¿è¡Œåœ¨è¿œç¨‹ EC2 æœåŠ¡å™¨ä¸Šã€‚ç”±äºå‰ç«¯æ— æ³•ç›´æ¥è®¿é—®è¿œç¨‹æœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ SSH éš§é“æ¥å»ºç«‹è¿æ¥ã€‚

## ğŸ”§ æ¶æ„ä¿¡æ¯

- **è¿œç¨‹æœåŠ¡å™¨**: `52.54.232.223`
- **API ç«¯å£**: `9580`
- **API åŸºç¡€è·¯å¾„**: `/api/v1/generate/v0/`
- **è®¤è¯æ–¹å¼**: `X-API-Key` Header
- **æµ‹è¯• API Key**: `test-api-key-123456`

## ğŸ“¡ API ç«¯ç‚¹

### 1. ç”Ÿæˆè§†é¢‘ (POST)
```bash
POST http://localhost:9580/api/v1/generate/v0/image-to-video
Headers:
  X-API-Key: test-api-key-123456
Body (FormData):
  image: [å›¾ç‰‡æ–‡ä»¶]
  promptText: [å¯é€‰æç¤ºè¯]
```

### 2. æŸ¥è¯¢çŠ¶æ€ (GET)
```bash
GET http://localhost:9580/api/v1/generate/v0/videos/{video_id}
Headers:
  X-API-Key: test-api-key-123456
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æ–¹æ³• 1: ä½¿ç”¨è‡ªåŠ¨åŒ–è„šæœ¬ (æ¨è)

#### macOS/Linux ç”¨æˆ·:

1. æ‰“å¼€ç»ˆç«¯ï¼Œè¿›å…¥é¡¹ç›®ç›®å½•
2. è¿è¡Œè„šæœ¬ï¼š
   ```bash
   chmod +x setup_ssh_tunnel.sh
   ./setup_ssh_tunnel.sh
   ```

#### Windows ç”¨æˆ·:

1. ç¡®ä¿å·²å®‰è£… OpenSSH å®¢æˆ·ç«¯ï¼š
   - è®¾ç½® â†’ åº”ç”¨ â†’ å¯é€‰åŠŸèƒ½ â†’ æ·»åŠ åŠŸèƒ½ â†’ OpenSSH å®¢æˆ·ç«¯
2. åŒå‡»è¿è¡Œ `setup_ssh_tunnel.bat`

### æ–¹æ³• 2: æ‰‹åŠ¨è®¾ç½® SSH éš§é“

#### macOS/Linux:
```bash
# è®¾ç½®å¯†é’¥æ–‡ä»¶æƒé™
chmod 600 ssh_key

# å»ºç«‹ SSH éš§é“
ssh -i ssh_key \
    -L 9580:localhost:9580 \
    -N \
    -o "ServerAliveInterval=60" \
    -o "ServerAliveCountMax=3" \
    ec2-user@52.54.232.223
```

#### Windows (PowerShell/CMD):
```cmd
ssh -i ssh_key ^
    -L 9580:localhost:9580 ^
    -N ^
    -o "ServerAliveInterval=60" ^
    -o "ServerAliveCountMax=3" ^
    ec2-user@52.54.232.223
```

## ğŸŒ ä½¿ç”¨å‰ç«¯ç•Œé¢

1. **å¯åŠ¨ SSH éš§é“**ï¼ˆå¦‚ä¸Šæ‰€è¿°ï¼‰

2. **æ‰“å¼€å‰ç«¯é¡µé¢**:
   - æµè§ˆå™¨ä¸­æ‰“å¼€ `parrot_api_frontend.html`

3. **é€‰æ‹© Testing Provider**:
   - Provider ä¸‹æ‹‰èœå•ä¸­é€‰æ‹© `ğŸ§ª Testing (New Architecture)`
   - API Key ä¼šè‡ªåŠ¨å¡«å……ä¸º `test-api-key-123456`

4. **ä¸Šä¼ å›¾ç‰‡å¹¶ç”Ÿæˆ**:
   - ä¸Šä¼ ä¸€å¼ æˆ–å¤šå¼ å›¾ç‰‡
   - è¾“å…¥æç¤ºè¯ï¼ˆå¯é€‰ï¼‰
   - ç‚¹å‡»"ç”Ÿæˆè§†é¢‘"æŒ‰é’®

## ğŸ” æµ‹è¯•è¿æ¥

åœ¨å‰ç«¯ç•Œé¢ä¸­ï¼Œå¯ä»¥ç‚¹å‡» **ğŸ” Test** æŒ‰é’®æ¥æµ‹è¯•è¿æ¥æ˜¯å¦æ­£å¸¸ã€‚

æˆåŠŸçš„è¿æ¥æµ‹è¯•åº”è¯¥æ˜¾ç¤ºï¼š
- âœ… Connection test successful!
- Status: 200/201/202

## â— å¸¸è§é—®é¢˜

### 1. "Connection refused" æˆ– "Network Error"

**åŸå› **: SSH éš§é“æœªå»ºç«‹æˆ–å·²æ–­å¼€

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ SSH éš§é“è„šæœ¬æ˜¯å¦åœ¨è¿è¡Œ
- ç¡®ä¿ç»ˆç«¯çª—å£ä¿æŒæ‰“å¼€
- é‡æ–°è¿è¡Œ SSH éš§é“è„šæœ¬

### 2. "Permission denied (publickey)"

**åŸå› **: SSH å¯†é’¥æƒé™ä¸æ­£ç¡®ï¼ˆä»…é™ macOS/Linuxï¼‰

**è§£å†³æ–¹æ¡ˆ**:
```bash
chmod 600 ssh_key
```

### 3. "Port 9580 already in use"

**åŸå› **: ç«¯å£å·²è¢«å ç”¨

**è§£å†³æ–¹æ¡ˆ**:
```bash
# macOS/Linux
lsof -ti:9580 | xargs kill -9

# Windows
netstat -ano | findstr :9580
taskkill /PID [è¿›ç¨‹ID] /F
```

### 4. SSH è¿æ¥è¶…æ—¶

**åŸå› **: ç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å™¨ä¸å¯è¾¾

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- ç¡®è®¤æœåŠ¡å™¨ IP åœ°å€æ˜¯å¦æ­£ç¡®
- è”ç³»æœåŠ¡å™¨ç®¡ç†å‘˜æ£€æŸ¥æœåŠ¡å™¨çŠ¶æ€

## ğŸ” å®‰å…¨æ³¨æ„äº‹é¡¹

1. **SSH å¯†é’¥ä¿æŠ¤**:
   - `ssh_key` æ–‡ä»¶åŒ…å«ç§é’¥ï¼Œè¯·å‹¿åˆ†äº«æˆ–æäº¤åˆ°å…¬å…±ä»£ç ä»“åº“
   - å·²æ·»åŠ åˆ° `.gitignore` ä¸­

2. **API Key ä¿æŠ¤**:
   - æµ‹è¯• API Key (`test-api-key-123456`) ä»…ç”¨äºå¼€å‘æµ‹è¯•
   - ç”Ÿäº§ç¯å¢ƒè¯·ä½¿ç”¨æ­£å¼çš„ API Key

## ğŸ“Š è°ƒè¯•ä¿¡æ¯

### æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

å‰ç«¯æ§åˆ¶å°ä¼šæ˜¾ç¤ºè¯¦ç»†çš„è¯·æ±‚/å“åº”ä¿¡æ¯ï¼š
- æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
- åˆ‡æ¢åˆ° Console æ ‡ç­¾
- æŸ¥çœ‹å¸¦æœ‰ `===` æ ‡è®°çš„è°ƒè¯•ä¿¡æ¯

### æ‰‹åŠ¨æµ‹è¯• API

ä½¿ç”¨ curl å‘½ä»¤ç›´æ¥æµ‹è¯•ï¼š

```bash
# æµ‹è¯•ç”Ÿæˆæ¥å£
curl -X POST "http://localhost:9580/api/v1/generate/v0/image-to-video" \
     -H "X-API-Key: test-api-key-123456" \
     -F "image=@/path/to/your/image.jpg" \
     -F "promptText=A beautiful sunset"

# æµ‹è¯•æŸ¥è¯¢æ¥å£
curl -X GET "http://localhost:9580/api/v1/generate/v0/videos/[video_id]" \
     -H "X-API-Key: test-api-key-123456"
```

## ğŸ“ ä¸å…¶ä»– Provider çš„åŒºåˆ«

| ç‰¹æ€§ | Testing Backend | Staging/Original |
|------|----------------|------------------|
| è¿æ¥æ–¹å¼ | SSH éš§é“ â†’ ç›´è¿ | é€šè¿‡ä»£ç†æœåŠ¡å™¨ |
| API è·¯å¾„ | `/api/v1/generate/v0/` | `/generate/` æˆ– `/generate/2.2/` |
| è®¤è¯å¤´ | `X-API-Key` | `X-API-KEY` |
| å“åº”æ ¼å¼ | æ–°æ ¼å¼ | æ—§æ ¼å¼ |
| çŠ¶æ€æŸ¥è¯¢ | ç›´è¿ API | é€šè¿‡ä»£ç† |

## ğŸ› ï¸ å¼€å‘è€…ä¿¡æ¯

### ä¿®æ”¹å†å²
- æ·»åŠ äº† `testing` provider é…ç½®
- ä¿®æ”¹ `checkVideoStatus()` æ”¯æŒæ–°æŸ¥è¯¢è·¯å¾„
- ä¿®æ”¹ `submitTask()` æ”¯æŒç›´è¿è¯·æ±‚
- æ›´æ–°äº† UI ä¸‹æ‹‰é€‰æ‹©å™¨

### ç›¸å…³æ–‡ä»¶
- `parrot_api_frontend.html` - å‰ç«¯ç•Œé¢ï¼ˆå·²æ›´æ–°ï¼‰
- `setup_ssh_tunnel.sh` - Linux/macOS SSH éš§é“è„šæœ¬
- `setup_ssh_tunnel.bat` - Windows SSH éš§é“è„šæœ¬
- `ssh_key` - SSH ç§é’¥æ–‡ä»¶ï¼ˆä¸è¦åˆ†äº«ï¼ï¼‰

## ğŸ¤ æŠ€æœ¯æ”¯æŒ

å¦‚é‡åˆ°é—®é¢˜ï¼Œè¯·æä¾›ï¼š
1. ä½¿ç”¨çš„æ“ä½œç³»ç»Ÿ
2. SSH éš§é“æ˜¯å¦æˆåŠŸå»ºç«‹
3. æµè§ˆå™¨æ§åˆ¶å°çš„é”™è¯¯ä¿¡æ¯
4. æµ‹è¯•è¿æ¥çš„å®Œæ•´å“åº”

---

**æ³¨æ„**: ä½¿ç”¨å®Œæ¯•åï¼Œè®°å¾—å…³é—­ SSH éš§é“ï¼ˆCtrl+Cï¼‰ä»¥é‡Šæ”¾èµ„æºã€‚

